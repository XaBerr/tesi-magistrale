% This repository contains a brief documentation for the \textbf{Position Alinement Tracking Fine} system.

\lvliii{Introduction}

The PAT-Fine system want to align the incoming beam into a sensor's
point. To do so we use three elements: \textbf{sensor},
\textbf{controller}, \textbf{actuator}.

% \img{simplified-model}{Simplified model of PAT system.}

The beam reflected by the mirror arrived into a sensor. The sensor take
a picture of himself that is called \textbf{frame}. The controller
calculate the \textbf{centroid} of the frame and then calculate the
distance between the centroid and the \textbf{target} point. When it
know the distance, it move the mirror to compensate the error.

In this system there are two basic setups, one with
\textbf{mirror-camera-pc} and one \textbf{mirror-PSD-KPA101}.

\lvliv{Mirror-camera-pc}

In this setup we have the pc connected with two devices: the first is
the KPA101 used to control the mirror; the second is the camera used as
sensor.

Here we have two types of controllers available: \textbf{manual},
\textbf{calibrated}.

Manual give the possibility to move the mirror using a joystick taking
in input times and voltages.

Calibrated has two functionalities: the first is to use a joystick
similar to manual that it work taking in input a distance in pixels; the
second is to use and automatic controller that align the centroid to the
target that it is called \textbf{One shot}.

\lvliv{Mirror-PSD-KPA101}

In this setup we have the pc connected only to the KPA101, the KPA101 is
then connected to the mirror and to the PSD.

Here we have three types of controllers available: \textbf{manual},
\textbf{calibrated}, \textbf{PIDKPA101}.

Manual and calibrated are the same as the previous point.

PIDKPA101 use the integrated PID-controller available in the KPA101.

\lvliii{GUI}

\img{gui}{Main GUI of the program.}

We can divide the GUI into two parts: the left side show the sensor
information, the right side show the controllers information.

In the sensor's side we have (form the top):

\begin{itemize}
      \itemsep1pt\parskip0pt\parsep0pt
      \item
            The frame rendering that contains three objects:
      \item
            the red dots represents the centroid of the beam;
      \item
            the red square represents the area where the controller calculates the
            centroid;
      \item
            the green circle represents the target.
      \item
            The set of parameters of the camera/PSD.
      \item
            The set of parameters to position the target.
      \item
            The plotter that show in real time the distances in pixels between the
            target and the centroid.
\end{itemize}

In the controller's side we have: manual controller, calibrated
controller and PIDKPA101 controller (only for PSD). The Manual
controller and the PID controller are self explanatory. In the manual
controller you set voltages and times to optimize the joystick that will
be use for the movement.

In the PIDKPA101 after chose the PID parameters press \emph{enable PID}
to start the controller. The \emph{auto open closed loop} is used to
disable the controller when the intensity of the beam go outside the
threshold range.

The calibrated controller is more complex so I reserve a separate
section for it.

\lvliv{Calibrated controller}

\imgThree{0.3}{calibrated1}{Controller interface.}{0.3}{calibrated2}{Analyzer interface.}{0.3}{calibrated3}{Graph interface.}

The aim of this controller is to be able to use the \emph{One shot
      controller}, but before to be able to use it we need to calibrate the
controller. The calibration procedure can be decomposed into two parts:
data acquisition, data analysis.

\paragraph{Data acquisition}

In this phase we want to acquire the calibration points. The procedure
is the following:

\begin{itemize}
      \itemsep1pt\parskip0pt\parsep0pt
      \item
            in the \emph{Analyzer} tab set the voltages and the time interval;
      \item
            autogenerate the filename;
      \item
            start the point acquisition.
\end{itemize}

\paragraph{Data analysis}

In this phase we want to analyze the calibration points store into a
file. The procedure is the following:

\begin{itemize}
      \itemsep1pt\parskip0pt\parsep0pt
      \item
            in the \emph{Controller} tab select the file and press \emph{Upload
                  and Calibrated};
      \item
            go into \emph{Graphs} tab and check that the analysis is completed
            correctly;
      \item
            if everything is ok then go into the \emph{Controller} tab and set the
            configuration to the low voltages or high voltages pressing the
            corresponding button.
\end{itemize}

\paragraph{One shot controller}

When you have chose both low and high voltages you are ready to press
the button to enable the controller in the \emph{Controller} tab. To
swap between high and low voltages you can set the time movement
threshold in the same tab.

\lvliii{Classes UML}

This project is complex, it has a lot of components. In order to help
you navigate into them, here I list the corresponding UML diagrams.

\lvliv{Setup}

\img{Setup}{Setup UML.}

\lvliv{Utils}

\img{Utils}{Utils UML.}

\lvliv{Centroid}

\img{Centroid}{Centroid UML.}

\lvliv{KPA101}

\img{KPA101}{KPA101 UML.}

\lvliv{Mirror}

\img{Mirror}{Mirror UML.}

\lvliv{PSD}

\img{PSD}{PSD UML.}

\lvliv{Camera}

\img{Camera}{Camera UML.}

\lvliv{Controller}

\img{Controller}{Controller UML.}
