\lvli{PATLIC experiment}
In the previous chapters, quantum communication and QKD were introduced, then the importance of the PAT for the QKD and its main components PATC and PATF were explained.
After that, it was shown how the code was created to control the PAT. Now it will be shown how to use what was previously realized in a real setup that has been implemented and tested in the laboratory.

This chapter contains the description of the experiment used to test the PAT system. It starts with a description of the setup and then describe how to assemble it.

\imgs{0.2}{pictures/PATLIC}{Pictures of the Alice and Bob telescopes used in the PATLIC experiment.}

\lvlii{Introduction}
In this experiment, a PAT system was developed between two telescopes in order to realize free-space QKD at 1550 nm with single-mode fiber injection. This experiment is called PATLIC (PAT system for Light Injection on C-band fiber).
The objective of this preliminary test in the laboratory was to check that the functionality of the developed software works in a controlled environment.

\lvlii{Optical setup}
\img{PATLIC/setup-ottico}{PATLIC optical setup. The acronyms are: wavelength division multiplexing (WDM), dichroic mirror (DM), beam expander (beam exp), and beam reducer (beam red).}
In this experiment there is a transmitter (Alice) and a receiver (Bob). As shown in~\fig{PATLIC/setup-ottico} they use a PATF's beam (blue) at 980 nm and two PATC's beams (red) at 850 nm, to inject a 1550 nm signal's beam (yellow) named SIG into a single-mode fiber.

From Alice two lasers at 1550 nm and at 980 nm are guided by single-mode fibers into a wavelength division multiplexing that combine them. The fiber's signal is released in free-space by a fiber port. It is collimated by a lens before entering a beam expander that prepare it for the communications link. The signal is then received by Bob where a beam reducer convert it into a smaller collimated beam. The beam reflected by a FSM impacts on a dichroic mirror. The dichroic mirror separates the SIG's beam at 1550 nm from the PATF's beam at 980 nm. The PATF's beam cross a band-pass filter at 980 nm and then cross a lens that focuses it into a PSD. Instead, the SIG's beam cross a band-pass filter at 1550 nm and then cross a lens that focuses it into a single-mode fiber.

From Alice there is a third laser at 850 nm that shines a divergent beam into the free-space. This beam is then focused at Bob's side on a camera. To increase the signal to noise ratio, a filter is put in front of the camera. This setup was also duplicated in the Bob-to-Alice direction.

\lvlii{Physical setup}
\img{PATLIC/mount}{PATLIC physical setup with Alice on the left and Bob on the right. In this picture we can see how PATF and PATC are mechanically combined ina single platform.}

As shown in the \fig{PATLIC/mount} PATF and PATC are united to create a single PAT system. These two structures represent Alice on the left, and Bob on the right. Alice and Bob are then attached to their respective mounts through the dovetail bars.
The input point for Alice is the fiber port, where the WDM will be attached through a fiber shown in \fig{PATLIC/setup-ottico}. The fiber port (yellow) contains a lens plane-convex with focal 15.3 mm that collimate the beam exiting from the fiber and traveling for 60 mm. Then the beam enter in the expander (ochre-yellow) composed by three lenses used to increase the beam waist. The beam finds: a achromatic-doublet convex-plane lens with focal 50 mm and then travels for 85 mm; a plane-concave lens with focal -150 mm and then travels for 197 mm; and a achromatic-doublet plane-convex lens with focal 250 mm. The beam then exits from Alice and propagates toward Bob.

When reach Bob the beam is a little bit expanded due to the propagation and so it finds a beam reducer (ochre-yellow) with lenses similar to the beam expander, where the differences are to compensate this expansion. The beam finds: a achromatic-doublet convex-plane lens with focal 300 mm and then travels for 228 mm; a concave-plane lens with focal -150 mm and then travels for 130 mm, and achromatic-doublet plane-convex with focal 50 mm. The resulting 4mm-diameter beam is then reflected to the DM (orange) by a FSM (yellow) that is placed in the pupil plane of the receiving system. Then, the beam is divided in to paths: PATF, SIG.
In the PATF line, the beam finds a plane-convex lens (light-blue) with a focal 300 mm, followed by a band-pass filter (magenta) for 980 nm with a FWHM of 10 nm, and than it is focused on a PSD (dark-blue) after 300 mm of distance.
In the SIG line, a band-pass filter (magenta) for 1550 nm with a FWHM of 10 nm, and than it is focused on a fiber port (yellow) with a convex-plane lens with focal 18 mm.

Both PATC are attached and aligned to the main structures. For each, a laser beam (red) is received into a achromatic-doublet convex-concave lens (light-blue) with focal 300 mm through a filter (magenta) for 850 nm with a FWHM of 10 nm, and then it is focused after 300 mm into a 25Hz-camera (green).

\lvlii{Alignment procedure}
A raw manual alignment of the optical components is required before starting the PATSW.
The complete alignment procedure for PATHW will be divided into parts. At the end of each part it will be needed an activation of the corresponding PATSW in order to move into the next one.

\lvliii{Coarse alignment}
\begin{itemize}
  \item connect two visible lasers to the two fiber ports. This simplify the initial alignment procedure;
  \item diverge the two lasers that should be used in the PATC;
  \item mount both PATC's lasers and ensure that their beams are "parallel" to the beams of the visible lasers mounted in the fiber ports;
  \item ensure that PATC's lasers are immaged by the PATC's cameras;
  \item aim Alice on Bob and vice versa. You should try to get the beam-expander exiting beam into the beam-reducer. Make sure the PATC's lasers are "quite" centered in the cameras' pictures. Otherwise correct with laser's tip-tilt. Perfect center is impossible;
  \item take note of the camera's alignment coordinates in pixels given by PATSW. This is important if something went wrong and you need to start again the procedure. In the PATSW set the alignment-position targets using the alignment coordinates;
  \item make a calibration with PATSW on both mounts. This is required to use the One shot controller;
  \item enable the One shot controller.
\end{itemize}

\lvliii{Fine alignment}
\begin{itemize}
  \item Collimate the Alice's laser @1550 nm used for communication, and the Alice's laser @980 nm used for PAT fine. Connect them on the fiber port removing the visible lasers. Make sure their beams are coaxial;
  \item check the FSM on Bob. Make sure it is centered in x/y and has 45 degrees angle respect to the optical path;
  \item check the DM on Bob. Make sure it is centered in x/y and has 45 degrees angle respect to the optical path;
  \item mount the PATF lens and PSD on Bob. Be sure the PSD is positioned on the lens focus;
  \item turn on the Alice's lasers @1550 nm, @980 nm and be sure they arrive centered in Bob's fiber port and in the Bob's PSD. Otherwise correct with the placement of FSM, DM;
  \item make a calibration with PATSW on PSD. This is required to use the Home command;
  \item make a Home command with PATSW to put the FSM in its tip-tilt neutral position, then correct its placement so the laser is still visible in the PSD. For the correction you can use or the DM placement or the xy-axis controller on the PSD;
  \item recalibrate the PATSW. This is required to be sure the system is stable;
  \item activate the PID KPA101 control, paying attention to any inversion of axes due to the positioning of the PSD.
\end{itemize}

\lvliii{Multi-mode fiber alignment}
\begin{itemize}
  \item Check that the SIG's collimated beam after the DM has a diameter that allows the optimal matching with fiber. Measure the laser power where the fiber port will be placed. This power will be used as reference to understand if the amount of losses in the channel;
  \item disassemble the Bob fiber-port collimator and put it on a table inside a cage, and attach it on a multi-mode fiber;
  \item shoot a visible laser through the multi-mode fiber attached to Bob's fiber-port collimator and ensure that the outgoing beam is vertically and horizontally aligned and is collimated;
  \item reassemble fiber port in the mount with visible laser attached;
  \item check that the SIG's beam and the fiber-port exiting beam are aligned. Otherwise correct with the precision movements of the DM frame. Be sure that all PAT systems are switched on or the procedure doesn't work;
  \item mount a power meter at the end of the Bob's fiber swapping the visible laser.
  \item make sure to have a good fiber coupling by checking that the losses using the power before and after the fiber.
\end{itemize}

\lvliii{Single-mode fiber alignment}
\img{fiberport}{This image shows the adjustments sequence for the fiber-port. The image is taken in the Thorlabs website.}
\begin{itemize}
  \item Disassemble the multi-mode fiber and mount the single-mode fiber attached to the Bob's fiber port;
  \item choose an sequence to make your adjustments, and keep to that sequence as shown in~\fig{fiberport};
  \item turn each adjuster clockwise to maximize the output, then continue to turn slightly beyond local maxima (to ~95\% of your local maximum). If turning an adjuster clockwise decreases output, skip that adjuster for that round of adjustments and repeat. Once the local maxima values begin to decrease, reverse the direction, and turn each adjuster to maximize the output, and not beyond;
  \item make sure to have a good fiber coupling by checking that the losses using the power before and after the fiber.
\end{itemize}

% \lvliii{Calibration's tests}

\lvlii{Tests}
In this section in the first two points will be demonstrated how the two controllers PIDKPA101 and One shot behave in a laboratory experiment that simulates an experiment in the field.
In the last point will be demonstrated how the combinations of PATF and PATC work together to contrast a series of external impulses.

\lvliii{PIDKPA101 on/off with heat source turbolence}
\img{measure/PID_off}{Centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere while the PIDKPA101 controller is off.}
\img{measure/PID_on}{Centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere while the PIDKPA101 controller is on.}
\img{measure/PID_on_off}{Comparison between the centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere between the PIDKPA101 enabled and disabled.}
This test wants to see the ability of the PIDKPA101 controller to counter drift and high frequency fluctuations generated by a heat source between Alice and Bob, that simulates the turbulence of the atmosphere.

In \fig{measure/PID_off} where the controller is not enabled, it is possible to see the channel-fluctuation signals representing the distance between the centroid and the target in the two axes x (red) and y (blue).
In \fig{measure/PID_on} where the controller is enabled, it is possible to see the channel-fluctuation signals visibly reduced in both axes.

Another way to see the advantage is to represent the two signals as xy-coordinates in the sensor as shown in \fig{measure/PID_on_off} where the zero represents the target position. In this figure it can be clearly seen that  the fluctuations with the controller active represented by \textit{the blue square}, are more centered in the target and fluctuate less respect the others with the controller disabled represented by the \textit{red oval}.
The signal without the controller enabled has a centroid in $\vec{m}_{off} = (21.34, -3.68)$ pixel and has a square root variance per coordinate of $\vec{\sigma}_{off} = (10.04, 8.41)$ pixels. However, the signal with the controller enabled has a centroid in $\vec{m}_{on} = (-0.02,0.07)$ pixel and has a square root variance of $\vec{\sigma}_{on} = (1.30, 1.30)$ pixels. Comparing the two result the drift is compensated while the fluctuation is reduced by a factor of
\begin{equation}
  \frac{\sigma_{off, x}}{\sigma_{on, x}} = 7.72, \frac{\sigma_{off, y}}{\sigma_{on, y}} = 6.47
\end{equation}
in their respective axis.

An interesting detail is that the square shape generated by the controller is caused by the fact that there are two independent PID controllers for the x and y axis inside the KPA101.

\lvliii{One shot on/off with heat source turbolence}
\img{measure/OneShot_off}{Centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere while the One shot controller is off.}
\img{measure/OneShot_on}{Centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere while the One shot controller is on.}
\img{measure/OneShot_on_off}{Comparison between the centroid fluctuation signals generated by a heat source that simulates the turbulence of the atmosphere between the PIDKPA101 enabled and disabled.}

The three graphs \fig{measure/OneShot_off}, \fig{measure/OneShot_on}, and \fig{measure/OneShot_on_off} are similar to \fig{measure/PID_off}, \fig{measure/PID_on}, and \fig{measure/PID_on_off} but instead of comparing the PIDKPA101 they are comparing the One shot with the heat-turbulent-reference signal. The One shot controller used is adopting the calibration shown in \fig{calibrazione}.
As shown from \fig{measure/PID_on_off} the drift was compensated by moving the centroid from $\vec{m}_{off} = (21.34, -3.68)$ to $\vec{m}_{on} = (-0.75, 2.89)$ pixels, while fluctuations have worsened as seen by comparing the second-order centered moment from $\vec{\sigma}_{off} = (10.04, 8.41)$ to $\vec{\sigma}_{on} = (8.62, 29.67)$ pixels.
This worsening is due to the fact that this controller makes increase its error with the increasing of the frequency.
This means that One shot controller and PIDKPA101 are not interchangeable controllers. The controller One shot is therefore better suited in case of pointing a star where the PSD can not work because it receives not enough signal intensity and there are strong drift.

\lvliii{Test of the PATF and PATC}
\img{measure/coarse_off}{Coarse off.}
\img{measure/full_on}{Full on.}



% TODO: 
% - coarse: entrambe le figure hanno la stessa tipo perturbazione, nella 1 il drift esce, nella 2 no => anche se avessi avuto il fine nella 1 sarei uscito
% - fine: attivando il coarse, che il coarse compensa il drift e il fine può compensare. attivando e disattivando il fine si nota la differenza
% fare le passe se posso
